---
layout: home
title: Feature - Coupons
sidebar: features
lang: en
subnav: features_coupons_effects_index
---

#Coupon Effects ?

##How to create a new type of Coupon ?

>Our example will be base on a Coupon giving a particular product (a goodies) to any customer entering it and meeting its Condition.
In case you have trouble following our explanation, you can find the whole code as a module on [GitHub](https://github.com/gmorel/thelia2-coupon-give-free-product).


1) A Coupon has to implement the Thelia\Coupon\Type\CouponInterface Interface.

In order to save you some time, we advise to simply have your GiveProduct class extends our Thelia\Coupon\Type\CouponAbstract class.

Please create your new GiveProduct type class in your module. Preferably in the directory MyModule\Coupon\Type.


2) In order to inform Thelia2 about the existence of your new Coupon you would have to register it as a [Service](http://symfony.com/doc/current/book/service_container.html) :

local/modules/MyModule/Config/config.xml
```xml
<services>
    <service id="keyword.action" class="Keyword\Action\Keyword">
        <argument type="service" id="service_container"/>
        <tag name="kernel.event_subscriber"/>
    </service>
</services>
```


3) You would then have to implements 3 simple methods describing the Coupon :
- getName() which contains the i18n name of your coupon
  ex: "Add a free product to the customer cart"
- getInputName() which contains the i18n name of the input effect
  ex: "Product sale element id added to the cart"
- getToolTip() which contains the i18n description of your Coupon
  ex : "This Coupon will give the associated product to the customer cart. The Coupon will make sure one order can get only one free product."


4) Then the method responsible for the Coupon behavior. This is where all the strength of our Coupon module is :
The method exec() contains all the Coupon logic.
Beware it will be executed whenever the coupon is entered, whether the order is paid or not.
Example :
```php
    /**
     * Return effects generated by the coupon
     * A new product in the cart
     *
     * @return float The discount
     */
    public function exec()
    {
        // The CartItem price will be set to 0
        // So no need to return a discount
        $discount = 0;

        // Since the exec method will be called each time the cart checks its integrity
        //  We need to check if the free product has already been inserted in the Cart
        if (!$this->isAlreadyInCart($this->productSaleElementsId)) {

            /** @var ProductSaleElements $productToGive */
            $productToGive = $this->getFreeProduct();
            $this->addProductToCustomerCart($productToGive);
        }

        return $discount;
    }
```
You will be able to see the Coupon logic (Product retuct retrieval, CartItem insertion, Event and Action) on [GitHub](https://github.com/gmorel/thelia2-coupon-give-free-product).


5) You would then have to implements this attribute :
```
/** @var string Service Id  */
protected $serviceId = 'thelia.coupon.type.give_product';
```
Where "give_product" is the unique id of your Coupon. This is the name of the [Service](http://symfony.com/doc/current/book/service_container.html).


Your brand new custom Coupon is ready.